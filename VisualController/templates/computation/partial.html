{% extends "computation/baseDetails.html" %}

{% block menu_up %}
    <div id="talltabs-orange">
        <ul>
            <li><a href="/VisualControllerApp/comp/{{pk}}"><span>General results</span></a></li>
            <li class="active"><a href="/VisualControllerApp/computation/partial/{{pk}}"><span>Partial results</span></a></li>
            <li><a href="/VisualControllerApp/computation/configuration/{{pk}}"><span>Related Configuration</span></a></li>
        </ul>
    </div>
{% endblock %}

{% block content %}
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}highcharts.js" type="text/javascript"></script>

    <script>
        $(function () {
            $(document).ready(function() {
                Highcharts.setOptions({
                    global: {
                        useUTC: false
                    }
                });

                var chart;
                var tab = [
                    {%  for res in comp.partial_result %}
                        [
                            {% for val in res %}
                                {{ val }},
                            {% endfor %}
                        ],
                    {% endfor %}

                        ];

                var i = 0;
                chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container',
                        type: 'spline',
                        marginRight: 10,
                        events: {
                            load: function() {

                                // set up the updating of the chart each second
                                var series = this.series[0];
                                setInterval(function() {
                                    series.setData(tab[i],false);
                                    series.name = i
                                    i= (i+1) % {{ comp.partial_result|length }};
                                    chart.redraw();
                                }, 1500);

                            }
                        }
                    },
                    title: {
                        text: 'Partial results'
                    },
                    colors: [
                        '#f78d1d',
                        '#AA4643',
                        '#89A54E',
                        '#80699B',
                        '#3D96AE',
                        '#DB843D',
                        '#92A8CD',
                        '#A47D7C',
                        '#B5CA92'
                    ],
                    xAxis: {
                        type: 'datetime',
                        gridLineColor: "#6bbb06",
                        lineColor: "#6bbb06",
                        minorGridLineColor: "#6bbb06",
                        minorTickColor: "#6bbb06",
                        tickColor: "#6bbb06",
                        maxPadding: 0.05,
                        tickPixelInterval: 150
                    },
                    yAxis: {
                        title: {
                            text: 'Value'
                        },
                        gridLineColor: "#6bbb06",
                        lineColor: "#6bbb06",
                        minorGridLineColor: "#6bbb06",
                        minorTickColor: "#6bbb06",
                        tickColor: "#6bbb06",
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    tooltip: {
                        formatter: function() {
                            return '<b>'+ this.series.name +'</b><br/>'+
                                    Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) +'<br/>'+
                                    Highcharts.numberFormat(this.y, 2);
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    },
                    series: [{
                        name: '0',
                        data: tab[0]
                    }]
                });
            });

        });


    </script>

    <h2>Partial results of computation</h2>

    Results were gathered ech {{ comp.monitoring }} generations.

    <div id="container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
    â€‹

{% endblock %}