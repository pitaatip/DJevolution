{% extends "computation/baseDetails.html" %}

{% block menu_up %}
    <div id="talltabs-orange">
        <ul>
            <li><a href="/VisualControllerApp/comp/{{pk}}"><span>General results</span></a></li>
            <li class="active"><a href="/VisualControllerApp/computation/partial/{{pk}}"><span>Partial results</span></a></li>
            <li><a href="/VisualControllerApp/computation/configuration/{{pk}}"><span>Related Configuration</span></a></li>
        </ul>
    </div>
{% endblock %}

{% block content %}
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}highcharts.js" type="text/javascript"></script>

    <script>
        $(function () {
            $(document).ready(function() {
                Highcharts.setOptions({
                    global: {
                        useUTC: false
                    }
                });

                var chart;
                var tab = [
                    {%  for computation in comp.partial_result %}
                        [
                        {% for res in computation %}
                        [
                            {% for val in res %}
                                {{ val }},
                            {% endfor %}
                        ],
                            {% endfor %}
                        ],

                    {% endfor %}
                        ];

                var i = 0;
                chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container',
                        type: 'scatter',
                        inverted: true,
                        width: 900,
                        zoomType: 'xy',
                        events: {
                            load: function() {

                                // set up the updating of the chart each second
                                var series = this.series;
                                setInterval(function() {
                                    for(var j=0;j<tab.length;j++)
                                    {
                                    series[j].setData(tab[j][i],false);
                                    series[j].name = i + " Step"
                                    }
                                    i= (i+1) % {{ comp.partial_result.0|length }};
                                    chart.redraw();
                                }, 1500);

                            }
                        }
                    },
                    title: {
                        text: 'Partial results'
                    },
                    colors: [
                        'rgba(223, 83, 83, .5)',
                        'rgba(0, 0, 255, .5)',
                        'rgba(255, 0, 0, .5)',
                        'rgba(0, 255, 0, .5)',
                        'rgba(119, 152, 191, .5)',
                        'rgba(255,	20,	147	,.5)',
                        'rgba(0,	250,	154	,.5)',
                        'rgba(139,	90,	0,.5)',
                        'rgba(238,	180,	34	,.5)',
                        'rgba(238,	121,	66	,.5)',
                        'rgba(255,	69,	0	,.5)',
                        'rgba(142,	156,	142	,.5)',
                        'rgba(255,	193,	193	,.5)',
                        'rgba(139,	0,	0	,.5)'
                    ],
                    xAxis: {
                        reversed: false,
                        title: {
                            enabled: true,
                            text: 'f1'
                        },
                        gridLineColor: "#6bbb06",
                        lineColor: "#6bbb06",
                        minorGridLineColor: "#6bbb06",
                        minorTickColor: "#6bbb06",
                        tickColor: "#6bbb06",
                        maxPadding: 0.05,
                        tickPixelInterval: 150,
                        startOnTick: true,
                        endOnTick: true,
                        showLastLabel: true
                    },
                    yAxis: {
                        title: {
                            text: 'Value'
                        },
                        gridLineColor: "#6bbb06",
                        lineColor: "#6bbb06",
                        minorGridLineColor: "#6bbb06",
                        minorTickColor: "#6bbb06",
                        tickColor: "#6bbb06",
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    tooltip: {
                        formatter: function() {
                            return '<b>'+ this.series.name +'</b><br/>'+
                                    Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) +'<br/>'+
                                    Highcharts.numberFormat(this.y, 2);
                        }
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'left',
                        verticalAlign: 'top',
                        x: 100,
                        y: 70,
                        floating: true,
                        backgroundColor: '#FFFFFF',
                        borderWidth: 1
                    },
                    exporting: {
                        enabled: false
                    },
                    series: [
                        {%  for res in comp.new_result %}
                        {
                        name: '{{ forloop.counter }}  Computation',
                        data: tab[{{ forloop.counter0 }}][0],
                        visible: {% if forloop.first %} true {% else %} false {% endif %}

                        },
                        {% endfor %}
                    ]
                });
            });

        });


    </script>

    <h2>Partial results of computation</h2>

    Results were gathered ech {{ comp.monitoring }} generations.

    <div id="container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
    â€‹

{% endblock %}